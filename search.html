<!doctype html>
<html lang="es">

<body>

<!-- dropdown -->
    <div class="col-md-12 col-sm-6">
        <div class="btn-group btn-block">
            <button class="btn btn-default btn-block dropdown-toggle" type="button" data-toggle="dropdown">
                  <span>buscar por</span>
                <span class="pull-right"><span class="caret"></span></span>
            </button>

            <ul class="dropdown-menu btn-block">
                <li><a href="#" class="code_selection" id="">todos</a></li>
                <li><a href="#" class="code_selection" id="na">nombre</a></li>
                <li><a href="#" class="code_selection" id="co">código</a></li>
                <li><a href="#" class="code_selection" id="ip">ip</a></li>
                <li><a href="#" class="code_selection" id="ad">dirección</a></li>
                <li><a href="#" class="code_selection" id="te">teléfono</a></li>
            </ul>
        </div>
    </div>

    <!--input de búsqueda-->
    <div class="col-md-12 col-sm-6">
        <form>
            <div class="input-group">
                <input type="text" class="form-control" title="Busqueda" placeholder="ingrese búsqueda" id="inp_search_box">
                <span class="input-group-btn"><button class="btn btn-default" type="button" id="btn_search_box"> <span class="glyphicon glyphicon-search"></span></button></span>
            </div>
        </form>
    </div>

    <br/>

    <!-- Los resultados se muestran acá -->
<div class="row top-buffer">
    <div id="results">

    </div>
</div>

<script>
    $("#inp_search_box").focus();

    $(".code_selection").click(function(){
        var code = $(this).attr("id");

        //reemplazo de codigo en la string, no optimizar, anda.

        if (($("#inp_search_box").val().charAt(0) != ':')||(($("#inp_search_box").val().charAt(0) == ''))) {
            $("#inp_search_box").val(":" + code + " " + $("#inp_search_box").val());
        } else {
            $("#inp_search_box").val($("#inp_search_box").val().substring(4));
            $("#inp_search_box").val(":" + code + " " + $("#inp_search_box").val());
        }

        $("#inp_search_box").focus();

    });

    function sendQuery(){

        var searchString = $("#inp_search_box").val();

        if(searchString!=''){


            $.get("search.php", {query:searchString},function(external){
                $("#results").html(external);
            });
        }else{

            //revisar: a veces entra aca dos veces cuando se busca con enter y esta vacio
            //puede que no importe, porque si esta llegando significa que no hay busqueda

            $("#results").html("<br/><br/><p class='text-center bg-danger'>no se ingresaron datos</p>");

            $("#results").fadeOut(0).delay(100).fadeIn(100);

        }
    }

    $("#btn_search_box").click(function(){sendQuery()});

    $(document).keypress(function(event){
        if(event.which == 13){
            sendQuery();
        }
    });


</script>
</body>